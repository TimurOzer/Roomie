<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ä°lanlar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <h2>Mevcut Ä°lanlar</h2>
		<ul id="post-list">
			{% for post in posts %}
				<li>
					<strong>{{ post.user }}</strong> - {{ post.timestamp }}<br>
					{{ post.content }}<br>
					<em>{{ post.address }}</em><br>
					{% if post.image %}
						<img src="{{ post.image }}" width="150"><br>
					{% endif %}
					{% if post.budget %}BÃ¼tÃ§e: â‚º{{ post.budget }}<br>{% endif %}
					{% if post.no_smoking %}ğŸš­ Sigara kullanmÄ±yor<br>{% endif %}
					{% if post.no_pets %}ğŸ¾ Evcil hayvanÄ± yok<br>{% endif %}
					{% if post.only_female %}ğŸ‘© KadÄ±n ev arkadaÅŸÄ± arÄ±yor<br>{% endif %}
					{% if post.only_male %}ğŸ‘¨ Erkek ev arkadaÅŸÄ± arÄ±yor<br>{% endif %}
					<hr>
					<button onclick="secimYap('{{ post.user }}', 'cay')">â˜• Ã‡ay</button>
					<button onclick="secimYap('{{ post.user }}', 'kahve')">â˜• Kahve</button>
					<button onclick="secimYap('{{ post.user }}', 'carpi')">âŒ Ã‡arpÄ±</button>				
				</li>
			{% endfor %}
		</ul>
        <a href="{{ url_for('kartlar') }}">Kartlara DÃ¶n</a>
    </div>

	<script>
		const socket = io();

		socket.on('new_post', function(data) {
			const ul = document.getElementById('post-list');
			const li = document.createElement('li');

			li.innerHTML = `
				<strong>${data.user}</strong> - ${data.timestamp}<br>
				${data.content}<br>
				<em>${data.address}</em><br>
				${data.image ? `<img src="${data.image}" width="150"><br>` : ""}
				${data.budget ? `BÃ¼tÃ§e: â‚º${data.budget}<br>` : ""}
				${data.no_smoking ? "ğŸš­ Sigara kullanmÄ±yor<br>" : ""}
				${data.no_pets ? "ğŸ¾ Evcil hayvanÄ± yok<br>" : ""}
				${data.only_female ? "ğŸ‘© KadÄ±n ev arkadaÅŸÄ± arÄ±yor<br>" : ""}
				${data.only_male ? "ğŸ‘¨ Erkek ev arkadaÅŸÄ± arÄ±yor<br>" : ""}
				<br>
				<button onclick="secimYap('${data.user}', 'cay')">â˜• Ã‡ay</button>
				<button onclick="secimYap('${data.user}', 'kahve')">â˜• Kahve</button>
				<button onclick="secimYap('${data.user}', 'carpi')">âŒ Ã‡arpÄ±</button>
				<hr>
			`;
			ul.appendChild(li);
		});

		function secimYap(evSahibi, secimTuru) {
			fetch('/secim', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					ev_sahibi: evSahibi,
					secim: secimTuru
				})
			})
			.then(res => res.json())
			.then(data => {
				if (data.hata) {
					alert(data.hata);
				} else {
					alert("SeÃ§imin gÃ¶nderildi!");
				}
			});
		}
	</script>

</body>
</html>
