{% extends "base.html" %}

{% block content %}
<section class="mesaj-istekleri">
    <h2>Mesaj İstekleri</h2>
    
    <div class="istek-listesi">
        <h3>Bekleyen İstekler</h3>
        
        {% if beklemedeki_istekler %}
        <div class="istek-grid">
            {% for istek in beklemedeki_istekler %}
            <div class="istek-karti {{ istek.tip }}">
                <div class="istek-header">
                    <span class="istek-tip">
                        {% if istek.tip == 'kahve' %}☕ Kahve{% else %}🍵 Çay{% endif %}
                    </span>
                    <span class="istek-tarih">{{ istek.tarih|datetimeformat }}</span>
                </div>
                
                <div class="istek-icerik">
                    <div class="kullanici-bilgi">
                        <span class="username">{{ istek.gonderen_username }}</span>
                        <span class="ilan-baslik">{{ istek.ilan_baslik }}</span>
                    </div>
                    
					<!-- YENİ HALİ (değiştirin) -->
					<form method="POST" action="{{ url_for('mesaj_istek_islem') }}">
						<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
						<input type="hidden" name="istek_id" value="{{ istek.id }}">
						<button type="submit" name="islem" value="kabul" class="istek-kabul-btn">Kabul Et</button>
						<button type="submit" name="islem" value="red" class="istek-red-btn">Reddet</button>
					</form>

                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="bos-liste">Bekleyen istek bulunmamaktadır.</p>
        {% endif %}
    </div>
    
    <div class="kabul-edilenler">
        <h3>Kabul Edilenler</h3>
        
        {% if kabul_edilenler %}
        <div class="istek-grid">
            {% for istek in kabul_edilenler %}
            <div class="istek-karti kabul-edildi">
                <div class="istek-header">
                    <span class="istek-tip">
                        {% if istek.tip == 'kahve' %}☕ Kahve{% else %}🍵 Çay{% endif %}
                    </span>
                    <span class="istek-tarih">{{ istek.tarih|datetimeformat }}</span>
                </div>
                
                <div class="istek-icerik">
                    <div class="kullanici-bilgi">
                        <span class="username">{{ istek.gonderen_username }}</span>
                        <span class="ilan-baslik">{{ istek.ilan_baslik }}</span>
                    </div>
                    
                    {% if istek.oda_id %}
                    <a href="{{ url_for('mesaj_odasi', oda_id=istek.oda_id) }}" class="mesajlas-btn">
                        Mesajlaş
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="bos-liste">Henüz kabul edilmiş istek bulunmamaktadır.</p>
        {% endif %}
    </div>
</section>
{% endblock %}